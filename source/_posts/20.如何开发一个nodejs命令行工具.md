---
title: 如何从零开始开发一个 nodejs 命令行(cli)工具
description: 本文描述了如何从零开始开发一个 nodejs 的 cli 命令行工具的方法
keywords: nodejs,cli
date: 2020-10-10 15:12:00
updated: 2020-10-10 15:12:00
comments: 1
categories: 前端工程化
tags: []
permalink: node-js-cli-start-up
---

如今基于 `nodejs` 的 `cli` 工具层出不穷，尤其以前端脚手架工具更迭最为频繁，纯构建工具有 `grunt`、`gulp`、`webpack`、`parcel` 和 `rullup` 等，各前端框架也有各自的 `cli` 工具 `create-react-app`、`vue-cli` 和 `angular-cli`，各大厂的集成化解决方案 `fis`、`jdf`、`umi` 等。但是每个团队的应用场景不同，以上工具不一定完全满足需求，是时候自己动手开发一个定制化的 `cli` 工具了。

<!--more-->

要开发 `cli` 工具首先要知道 `cli` 是什么，以及如何在 `cli` 里执行自己开发的命令行工具。

## `cli` 是如何执行命令的

命令行界面（英文名称：Command Line Interface），是一种通过命令行来交互的工具或者应用。不同的操作系统内置了不同的 `cli`：

- unix-like
  - bash
  - sh
  - csh
  - zsh
  - ...
- windows
  - cmd.exe
  - PowerShell

通常情况下，一个命令对应了系统中的一个可执行文件，比如：`cd`、`ls`。当用户在 `cli` 中输入要执行的命令时，
`cli` 会去预先配置好的查找路径中去查找同名的可执行文件并运行它。
查找路径通常存在一个叫 `PATH` 的环境变量里。

比如 `osx` 系统可以通过命令 `$PATH` 知道其内容：

```nohighlight
> $PATH
-bash: /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin
```

接下来看看如何创建这个可执行文件。

## 创建 `npm` 包

首先通过 `npm init` 命令来创建一个 `npm` 包：

```nohighlight
> mkdir cli-test
> cd cli-test
> npm init -y
Wrote to /cli-test/package.json:

{
  "name": "cli-test",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}
```

## 创建可执行文件

- 在 `cli-test` 根目录新建一个文件 `bin/index.js`

```nohighlight
#!/usr/bin/env node

...
```

注意第一行的 `#!/usr/bin/env node`，`#!` 表示要指定脚本文件的解析程序，`/usr/bin/env` 表示要去哪里找解析程序，`node` 是解析程序的名字（表示这个要文件由 `nodejs` 来运行）。

- 并且在 `package.json` 中添加配置项：

```json
{
  "bin": {
    "cli-test": "bin/index.js"
  }
}
```

指定在 `cli` 中的名称为 `cli-test`，可执行文件为 `bin/index.js`。
当用户通过 `npm install` 安装这个模块的时候，`npm` 会根据不同的操作系统自动创建一个可执行文件，比如在 `osx` 中就会创建 `/usr/local/bin/cli-test` 文件并关联到该可执行文件。

- 为 `bin/index.js` 添加可执行权限（unix-like 系统）：

```bash
chmod +x bin/index.js
```

通过上面的步骤，一个 `cli` 命令行工具就创建完成了，接下来就可以编写工具的具体执行逻辑了，`bin/index.js` 也是一个 `nodejs` 模块，可以引用其它 `nodejs` 模块而且不需要添加执行权限：

```nohighlight
#!/usr/bin/env node

require('../cli.js')
```

未完待续...

## 参考资料

- [node.js api](https://nodejs.org/api/)
- [npm 包管理](https://docs.npmjs.com/packages-and-modules/)
- [yargs-parser](https://github.com/yargs/yargs-parser)
